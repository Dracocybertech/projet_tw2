
<!DOCTYPE html>
<html lang="fr" dir="ltr">





	<head>

    <style>
      body {
          background-image: url('assets/img/nature.jpg');
          background-size: cover;
          background-repeat: no-repeat;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
          height:100%;
      }

      img {
          max-width: 100%;
          max-height: 100%;
          display: flex;
      }

      input {
        display: block;
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        margin-bottom: 20px;
      }

      .container {
          background-color: rgba(255, 255, 255, 0.8);
          padding: 15px;
          border-radius: 10px;
      }

      .system{
        background: rgba(177, 177, 177, 0.45);
        border-radius: 15px;
        margin: 10px;
        padding: 10px;
        height: 100%;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        
      }
      .system-bar{
        margin: 1px;
        display: flex;
        justify-content: space-between;
      }

      .system-logout {
        display:inline-flex
      }

      .system-settings {
        
        display:inline-flex
      }

      .system-options-expanded{
        margin: 1px;
        width:100%;
        display:inline-flex;
        justify-content: flex-end;
      }

      .system-settings1 {
        display:inline-flex;
        margin-inline:10px;
      }

      .system-button {
        margin-inline: 10px;
        color: #fff;
        border-radius: 10px;
        background:red;
        border:0px;
      }

      .play-zone {
        background: red;
        padding:.5em;
        display:flex;
        justify-content: space-between;
      }

      .play-left {
        padding:.5em;
        background: orangered;
        display:flex;
        width:50%;
      }

      .play-right {
        padding:.5em;
        background: blue;
        display:flex;
        width:50%;
        flex-direction: column;
        align-content: stretch;
      }

      .play-left-characters {
        padding:.5em;
        background: blueviolet;
          width: 100%;
          height: auto;
          overflow-y: auto;
      }

      .play-right-background{
        padding:.5em;
        display:flex;
        width:100%;
        height:fit-content;
        }

      .play-right-stats{
        padding:.5em;
        background: yellow;
        display:flex;
        flex-direction: row;
        width:100%;
        height:100%;
      }

      

      .play-right-stats-summon{
        padding:.5em;
        background: yellowgreen;
          display:flex;
      }

      .play-right-stats-money{
        padding:.5em;
        background: cornflowerblue;
        display:flex;
      }

      .play-right-stats-moneypersec{
        padding:.5em;
        background: indianred;
          display:flex;
      }


      .character-list {
          width: 100%;
          display: flex;
          flex-direction: column;
      }

      .character {
          display: flex;
          align-items: center;
          margin-bottom: 10px;
      }

      .character-image {
          width: 50px;
          height: 50px;
          background-size: cover;
          margin-right: 10px;
      }

      .character-info {
          display: flex;
          flex-direction: column;
      }

      .character-name {
          font-size: 18px;
          font-weight: bold;
          margin-bottom: 5px;
      }

      .character-stats {
          font-size: 14px;
          margin-bottom: 5px;
      }

      .invocation-table {
          background-color: #f2f2f2;
          width: fit-content;
          border-collapse: collapse;
          text-align: center;
          table-layout: fixed;

      }

      .invocation-table td,
      .invocation-table th {
          border: 1px solid #ddd;
          padding: 8px;
          width: 102px;
      }

      .invocation-table tr:nth-child(even) {
          background-color: #f2f2f2;
      }

      .invocation-table td {
      }

      .invocation-table th {
          padding-top: 0px;
          padding-bottom: 12px;
          background-color: #4CAF50;
          color: white;
      }
  </style>




		<title>Stickman Impact</title>
		<script>
			window.addEventListener( 'load', ev => {
				goldPS=1;
				gold=100;
				ObjInterval = null,
				totalGold = document.querySelector( "#totalGold" ),
				totalGold.textContent = gold;
				function augmenter(){

					if (gold + goldPS <= Number.MAX_VALUE){
						gold += goldPS;
						totalGold.textContent = gold;
					} else if (ObjInterval){
						clearInterval(ObjInterval);
						gold = Number.MAX_VALUE;
					}
				}
				ObjInterval = setInterval(augmenter, 1000, gold, goldPS);
			});
		</script>


    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="description">
    <meta content="" name="keywords">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <!-- <link href="assets/css/main2.css" rel="stylesheet"> -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"> </script>


	</head>

	<body>

    <div class="container">
      <div class="system">
        <div class="system-bar">
          <div class="system-logout">
            <form action="/logout" method="post" role="form">
              <div>
                <button type="submit">
                  <div style="height:20px;width:20px;object-fit:contain;">
                    <img src="assets/img/logout.png">
                  </div>
                </button>
              </div>
            </form>
            Save & Exit
          </div>
          <div class="system-settings">
            <form action="/settings" method="post" role="form">
              <div>
                <button type="submit">
                  <div style="height:20px;width:20px;object-fit:contain;">
                    <img src="assets/img/settings.png">
                  </div>
                </button>
              </div>
            </form>
            Settings
          </div>
        </div>
        <div class="system-options-expanded">
          <div class="system-settings1">
            <button class="system-button">Music</button>
            <button class="system-button">Darkmode</button>
          </div>
        </div>
      </div>
      <div class="play-zone">
        <div class="play-left">
          <div class="play-left-characters">
            <div id ="affichageHeros" class="tabHeros">
              <table class="invocation-table">
                <thead>
                  <tr>
                    <th>Invocation</th>
                    <th>Niveau</th>
                    <th>Coût</th>
                    <th>Upgrade</th>
                    <th>Gold/s</th>
                    <th>Diamants/s</th>
                  </tr>
                </thead>
                
            </table>

              
                <liste_heros v-for="heros in herosObtenus" v-bind:personnage="heros.id_hero" v-bind:niveau="heros.niveau"/>
        
                <!-- v-bind:element="hero.goldpersec" v-bind:element="hero.diamondspersec" -->
        
            </div>
          </div>
        </div>
        <div class="play-right">
          <div class="play-right-background">
            <div style="object-fit:contain;">
              <img src="assets/img/test.jpeg">
            </div>
          </div>
          <div class="play-right-stats">
            <div class="play-right-stats-summon">
              <div id="app">
                <button style="background: v ar(--color-primary);border: 0; margin:5px; color: #fff; border-radius: 20px; background:red; border:2px" v-on:click="invocationHeros()">Invocation +</button>
                <p> Appuyer sur le bouton pour déclencher une invocation. Inspecter la page pour voir les console.log. </p>
              </div>
            </div>
            <div class="play-right-stats-money">
              <p id="totalGold"></p>
              Gold
            </div>
            <div class="play-right-stats-moneypersec">
            <input id="1gold" type="button" value="+1 g/s" onclick="goldPS=goldPS+1">
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="character-image" style="background-image: url('assets/img/stickman.jpg')"></div>
        <div class="character-info">
              <div class="character">
              <div class="character-name">Personnage 1</div>
              <div class="character-stats">Niveau: 10</div>
              <div class="character-stats">Gold/s: 100</div>
              <div class="character-stats">Diamants/s: 50</div>
        </div>
      </div> -->
    </div>


    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>
	</body>
</html>
















<script>


Vue.component("liste_heros",{
				
				template: `<table class=invocation-table>
            <tbody>
              <tr>
                <td>
                  {{ personnage }}
                </td>
                <td>
                  {{ niveau }}
                </td>
                <td>
                  val?
                </td>
                <td>
                  <button style="background: v ar(--color-primary);border: 0; margin:5px; color: #fff; border-radius: 20px; background:red; border:0px" v-on:click="invocationHeros()">++</button>
                </td>
                <td>
                  val?
                </td>
                <td>
                  val?
                </td>
              </tr>
            </tbody>
					</table>`,
        
				props: ["personnage", "niveau"] //, "goldpersec","diamondspersec" //<td>{{ goldpersec }}</td> <td>{{ diamondspersec }}</td>
        //<div class="character-image" style="background-image: url('assets/img/stickman.jpg')">
			})


  // const liste_heros = new Vue({
  //       el:"#affichageHeros",
  //       data: function() {

  //           //heros1:["personnage1",1,50,20];
  //           //heros2:["personnage2",3,40,30];
            
          
  //         return {
            
  //           heroes:[["personnage1",1,50,20],["personnage2",3,40,30],["personnage3",3,40,30]]

  //         }
            
  //       }
  // })


/*

  Vue.component('listecart',{ //A garder en commentaire car j'en aurai besoin pour plus tard

  template:`<li v-bind:id="'item_'+id">
      <button style="background: var(--color-primary);border: 0; color: #fff; border-radius: 20px; width:20px;" v-on:click="addItem()">+</button>  {{quantity}} <button style="background: var(--color-primary);border: 0; color: #fff; border-radius: 20px; width:20px;" v-on:click="removeItem()">-</button>
      &#215; {{name }} ($ {{price}} each)
     </li>`,
  props:["id", "quantity", "name", "price"],

  methods:{
          addItem: function() {
          console.log(this.id);
            app.addItem(this.id);
          },
          removeItem: function() {
          console.log(this.id);
            app.removeItem(this.id);
          },

          estVide: function() {
            app.estVide();
          },

        },

})*/

/*$(document).ready(function(){
  $.ajax({
    type: 'GET',
    url: '/cart/initialisationHerosObtenus',
    success: function(received) {
    console.log("Pweeeet initialisationHerosObtenus");
    console.log(received);
    joueur.herosObtenus = received; //Sauvegarde des héros de la db dans herosObtenus
   },
    error: function() {
      alert('Problème AJAX');
    }
  });
});*/


const joueur = new Vue({ //Vue du joueur
        el:"#affichageHeros",
        methods:{
          possedeHeros: function(heros) {//Fonction qui renvoie true si herosObtenus contient heros
            console.log("PWET possedeHeros");
            for (const herosObtenu of joueur.herosObtenus) {//Parcours de herosObtenus
              console.log(herosObtenu);
              console.log("herosObtenu.id_hero : "+herosObtenu['id_hero']);
              console.log("heros.id_hero : "+heros['id_hero']);
              if(herosObtenu['id_hero'] == heros['id_hero']) {//Comparaison des id qui sont uniques
                return true;
              }
            }
            return false;
          }
        },
        data:{
          herosObtenus:[],
        },
  });

$.ajax({
  type: 'GET',
  url: '/cart/initialisationHerosObtenus',
  success: function(received) {
  console.log("Pweeeet initialisationHerosObtenus");
  console.log(received);
  joueur.herosObtenus = received; //Sauvegarde des héros de la db dans herosObtenus
   },
    error: function() {
      alert('Problème AJAX');
    }
});

const app = new Vue({ //Vue qui gère les invocations de héros
        el:"#app",
        methods:{
          invocationHeros: function() { //Invocation de heros
             console.log("Pweeeet debut");
             console.log(totalGold.textContent);

             $.ajax({
               type: 'POST',
               url: '/cart/argentSuffisant',//Vérifie si le joueur a assez d'argent pour faire une invocation
               data: "argent="+totalGold.textContent,//Envoie de l'argent
               success: function(received) {
                 console.log("Pweeeet argentSuffisant");
                 console.log(received);
                 if (received) { //Si on a assez d'argent
                    totalGold.textContent = totalGold.textContent - 100;//A changer
                    let rarete = "";
                    $.get("/cart/rareteRandom", function (data, status, xhr) {//Obtention d'une rareté au hasard
                        if (status == "error") {
                          alert('erreur' + xhr.status + " " + xhr.statusText);
                        } else {
                            console.log("data : "+data);
                            rarete = data; //Sauvegarde de la rareté obtenue
                            console.log("rarete finale : "+rarete);
                            $.ajax({
                            type: 'POST',
                            url: '/cart/triParRarete',//Obtention d'un héros au hasard qui a la rareté demandée
                            data:"rarete="+rarete,//Envoie de la rareté
                            success: function(received) {
                              console.log("Pweeeet Fin triParRarete");
                              console.log(received);
                              let heros = received; //Sauvegarde du héros
                              console.log(joueur.possedeHeros(heros));
                              if (joueur.possedeHeros(heros)) { //Si le joueur possède déjà le héros
                                console.log("Remboursement en cours."); //On rembourse le joueur d'un montant X selon la rareté
                              }
                              else { //Si le joueur ne possède pas le héros
                                joueur.herosObtenus.push(heros); //On ajoute le héros à herosObtenus
                                console.log("Ajout d'un heros.");
                                console.log(joueur.herosObtenus);
                              }
                            },
                            error: function() {
                              alert('Problème AJAX');
                            }
                            });
                          };
                      });
                 }
                 else {
                    window.alert("Il n'y a pas assez d'argent pour acheter un heros ! Attendez d'avoir 100 golds."); //Message d'alerte pour signaler au joueur qu'il n'a pas assez d'argent
                 }
               },
               error: function() {
                 alert('Problème AJAX');
               }
            });

          },
        },
    })

</script>

<!--<script>

function invocationHeros(){
      console.log("invocationHeros");
      console.log(totalGold.textContent);
      };

</script>-->


</html>
